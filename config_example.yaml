# GMTSAR InSAR Processing Pipeline Configuration File
# This file contains all parameters needed for running the complete SBAS workflow
# Users can customize these values for their specific processing needs

# ==============================================================================
# PROJECT SETTINGS
# ==============================================================================
project_root: "/home/oksana/Desktop/nfs/Geodesy_LAB/sinai_plate"
orbit: "asc"  # Options: "asc" (ascending) or "des" (descending)

# ==============================================================================
# STAGE 1: DIRECTORY STRUCTURE CREATION
# ==============================================================================
# No additional parameters needed - uses project_root and orbit

# ==============================================================================
# STAGE 2: DOWNLOAD SENTINEL-1 DATA FROM ASF
# ==============================================================================
# WKT polygon defining area of interest (must be a closed polygon)
# Format: "POLYGON((lon1 lat1, lon2 lat2, ..., lon1 lat1))"
# Example below matches the bbox above
polygon: "POLYGON((31.6879 29.7193,32.4268 27.5483,33.9415 28.6081,32.975 30.2811,31.6879 29.7193))"

# Date range for Sentinel-1 data acquisition
# Format: "Month+Day,+Year" (URL-encoded format for ASF API)
# Adjust these dates to your study period
start_date: "January+1,+2014"
end_date: "December+31,+2024"

# Sentinel-1 relative orbit number (also called "path")
# Find your orbit number at: https://search.asf.alaska.edu
# Examples:
#   - Hawaii ascending: 124
#   - Hawaii descending: 87
#   - Israel ascending: 87
#   - Israel descending: 160
relative_orbit: 58, 160

# ASF EarthData credentials (REQUIRED for data download)
# Register for free at: https://urs.earthdata.nasa.gov
# IMPORTANT: Do NOT commit credentials to version control!
# Consider using environment variables or separate credentials file
asf_username: "your_earthdata_username"
asf_password: "your_earthdata_password"

# SAR polarization mode
# Options: "VV", "VH", "HH", "HV", "VV+VH", "HH+HV"
# Most common for land applications: "VV"
# For ocean/ice: consider "HH" or dual-pol
polarization: "VV"

# NOTE: Stage 2 can be skipped if you already have Sentinel-1 data
# To skip, simply don't include stage 2 in your pipeline run

# ==============================================================================
# STAGE 3: DEM CREATION
# ==============================================================================
# Bounding box for DEM (in decimal degrees): [minlon, maxlon, minlat, maxlat]
bbox: 

# DEM resolution mode
# 1 = SRTM1 (30m resolution)
# 2 = SRTM3 (90m resolution)
mode: 1

# Optional: explicit path to make_dem.csh if not in PATH
# make_dem_path: "/opt/GMTSAR/bin/make_dem.csh"

# ==============================================================================
# STAGE 4: ORBIT DOWNLOAD AND OPTIONAL REFRAMING
# ==============================================================================
# Orbit file mode
# 1 = precise orbits (recommended, available ~2 weeks after acquisition)
# 2 = restituted orbits (available within 24 hours)
orbit_mode: 1

# Reframing (stitching/cropping) settings
# Set reframe to true if you need to combine multiple frames or crop the scene
reframe: 

# Pin coordinates for reframing (required only if reframe: true)
# Pins should be ordered in along-track direction:
# - For ascending: pin1 (south) to pin2 (north)
# - For descending: pin1 (north) to pin2 (south)
pin1_lon: 
pin1_lat: 
pin2_lon: 
pin2_lat: 

# ==============================================================================
# STAGE 5: MASTER SELECTION AND ALIGNMENT
# ==============================================================================
# List of subswaths to process
# Standard Sentinel-1 TOPS has 3 subswaths: F1, F2, F3
subswath_list:
  - "F1"
  - "F2"
  - "F3"

# Master image selection is automatic based on baseline analysis
# The script will select the image closest to the temporal+spatial centroid
# No manual parameters needed

# ==============================================================================
# STAGE 6: INTERFEROGRAM GENERATION
# ==============================================================================
# Temporal baseline threshold (days)
# Only image pairs separated by less than this many days will be processed
# Typical range: 48-200 days
threshold_time: 50

# Perpendicular baseline threshold (meters)
# Only image pairs with perpendicular baseline less than this will be processed
# Typical range: 100-300 meters
threshold_baseline: 180

# Path to batch_tops.config configuration file
# This file contains GMTSAR processing parameters
# If not specified, default parameters will be used
# config_path: "path/to/batch_tops.config"

# ==============================================================================
# STAGE 7: INTERFEROGRAM MERGING
# ==============================================================================
# Merge mode
# 1 = merge all subswaths
# 2 = merge only specified subswaths
merge_mode: 1

# ==============================================================================
# STAGE 8: PHASE UNWRAPPING
# ==============================================================================
# Coherence threshold for unwrapping
# Pixels with coherence below this value will be masked
# Range: 0.0 - 1.0, typical: 0.05 - 0.15
coherence_threshold: 0.075

# Correlation threshold
# Additional quality metric for phase unwrapping
# Range: 0.0 - 1.0, typical: 0.01 - 0.05
corr_threshold: 0.01

# Maximum discontinuity threshold
# Controls how aggressive the unwrapping algorithm is
# Range: 10 - 100, typical: 40
max_dis_threshold: 40

# Use landmask to exclude water areas
# Requires landmask.grd file in topo directory
use_landmask: false

# Use default masking based on correlation and coherence
use_mask_def: true

# ==============================================================================
# PARALLEL PROCESSING
# ==============================================================================
parallel:
  # Number of CPU cores to use for parallel processing
  # Set to number appropriate for your machine (check with: nproc)
  num_cores: 12

  # Enable parallel subswath processing in Stage 6
  # When true, F1, F2, F3 are processed simultaneously
  parallel_subswaths: true

  # Enable parallel reframing in Stage 4 (experimental)
  # Uses directory isolation to run multiple dates simultaneously
  # Provides ~3-4x speedup for reframing step
  parallel_reframe: false

  # Number of parallel workers for reframing (if parallel_reframe is true)
  # Recommended: 4-6 workers for 16GB RAM, 6-8 for 32GB RAM
  reframe_workers: 4

# ==============================================================================
# ADVANCED OPTIONS
# ==============================================================================
advanced:
  # Skip stages that have already been completed
  skip_completed: true

  # Verbose output
  verbose: true

# ==============================================================================
# USAGE EXAMPLES
# ==============================================================================
# Run complete pipeline from start (including data download):
#   python main.py --project-root /path/to/project --config config_example.yaml --sequential
#
# Run pipeline skipping stage 3 (if you already have data):
#   python main.py --project-root /path/to/project --config config_example.yaml --start-stage 1 --end-stage 2 --sequential
#   python main.py --project-root /path/to/project --config config_example.yaml --start-stage 4 --end-stage 8 --sequential
#
# Run only data download stage:
#   python main.py --project-root /path/to/project --config config_example.yaml --stage 3
#
# Run specific stage:
#   python main.py --project-root /path/to/project --stage 5
#
# Resume from last completed stage:
#   python main.py --project-root /path/to/project --resume
#
# Check processing status:
#   python main.py --project-root /path/to/project --status
